$(function(){marked=SG.markSettingNoHightlight(),$(".desc").html(marked($(".desc").text().trim())),$(".noavatar").each(function(){var t=$(this).data("author"),t=md5(t+""),t="data:image/svg+xml;base64,"+new Identicon(t,{format:"svg",size:32}).toString();$(this).attr("src",t)});var e=$("#follow").data("follow");$("#follow").on("click",function(){var a=this;$.post("/subject/follow",{sid:$(this).data("sid")},function(t){t.ok&&(e?(e=!1,$(a).removeClass("btn-followed").addClass("btn-success"),$(a).html('<i class="fa fa-plus" aria-hidden="true"></i> 关注')):(e=!0,$(a).removeClass("btn-success").addClass("btn-followed"),$(a).html('<i class="fa fa-check" aria-hidden="true"></i> 已关注')))})}),$("#follow").on("mouseenter",function(){e&&$(this).html('<i class="fa fa-remove" aria-hidden="true"></i> 取消关注')}),$("#follow").on("mouseleave",function(){e&&$(this).html('<i class="fa fa-check" aria-hidden="true"></i> 已关注')}),$("#contribute").on("click",function(){var t=$("#follow").data("sid");$.getJSON("/subject/my_articles?sid="+t,function(t){t.ok&&(s(t.data.articles),$("body").addClass("modal-open"),$(".contribute-modal").fadeIn())})}),$(".contribute-modal .close").on("click",function(){$("body").removeClass("modal-open"),$(".contribute-modal").fadeOut()});var o="";function s(t){var a,e="";for(a in t)e+='<li><div class="article-div" data-id="'+t[a].id+'">',t[a].had_add?e+='<div class="note-name has-add">'+t[a].title+'</div><span class="status has-add">已加入</span><a class="action-btn remove">移除</a>':e+='<div class="note-name">'+t[a].title+'</div><a class="action-btn push">投稿</a>',e+="</div></li>";$("#contribute-note-list").html(e)}$(".contribute-modal .search-btn").on("click",function(){var e,t,a=$(".contribute-modal .search-input").val();""!=a?(o=$("#contribute-note-list").html(),$("#contribute-note-list").html(""),(e=$(".contribute-modal .modal-notes-placeholder")).show(),t=$("#follow").data("sid"),$.getJSON("/subject/my_articles?kw="+encodeURIComponent(a)+"&sid="+t,function(t){var a;e.hide(),t.ok?0==(a=t.data.articles).length?$("#contribute-note-list").html('<div class="default">未找到相关文章</div>'):s(a):$("#contribute-note-list").html('<div class="default">'+t.msg+"</div>")})):$("#contribute-note-list").html(o)}),$(".contribute-modal .search-input").on("change",function(){""==$(this).val()&&$("#contribute-note-list").html(o)}),$(document).keypress(function(t){10!=t.which&&13!=t.which||$(".contribute-modal .search-btn").click()}),$(".contribute-modal").on("click",".action-btn",function(){var a=$(this).parent(),t=a.data("id"),e=$("#follow").data("sid"),o=this;$(this).hasClass("push")?$.post("/subject/contribute",{sid:e,article_id:t},function(t){t.ok?(a.children(".note-name").addClass("has-add"),$(o).removeClass("push").addClass("remove").before('<span class="status has-add">已加入</span>').text("移除")):alert(t.error)}):$.post("/subject/remove_contribute",{sid:e,article_id:t},function(t){t.ok?(a.children(".note-name").removeClass("has-add"),$(o).removeClass("remove").addClass("push").text("投稿"),a.children(".status").remove()):alert(t.error)})})});